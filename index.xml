<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Go猜想录</title>
    <link>https://luxcgo.github.io/</link>
    <description>Recent content on Go猜想录</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <copyright>2020-2022 Go猜想录</copyright>
    <lastBuildDate>Tue, 12 Apr 2022 01:21:16 +0800</lastBuildDate>
    
        <atom:link href="https://luxcgo.github.io/index.xml" rel="self" type="application/rss+xml" />
    
    
    
        <item>
        <title>Blrec Flv源码分析</title>
        <link>https://luxcgo.github.io/posts/blrec-flv%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</link>
        <pubDate>Tue, 12 Apr 2022 01:21:16 +0800</pubDate>
        
        <guid>https://luxcgo.github.io/posts/blrec-flv%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</guid>
        <description>Go猜想录 https://luxcgo.github.io/posts/blrec-flv%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ -&lt;h2 id=&#34;stream_processorpy&#34;&gt;stream_processor.py&lt;/h2&gt;
- https://luxcgo.github.io/posts/blrec-flv%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ - 2020-2022 Go猜想录</description>
        </item>
    
    
    
        <item>
        <title>Golang Gateway</title>
        <link>https://luxcgo.github.io/posts/golang-gateway/</link>
        <pubDate>Sat, 26 Mar 2022 15:59:06 +0800</pubDate>
        
        <guid>https://luxcgo.github.io/posts/golang-gateway/</guid>
        <description>Go猜想录 https://luxcgo.github.io/posts/golang-gateway/ -&lt;h2 id=&#34;tcp获取完整数据报文&#34;&gt;TCP获取完整数据报文&lt;/h2&gt;
- https://luxcgo.github.io/posts/golang-gateway/ - 2020-2022 Go猜想录</description>
        </item>
    
    
    
        <item>
        <title>Rust入门</title>
        <link>https://luxcgo.github.io/posts/rust-intro/</link>
        <pubDate>Sat, 26 Feb 2022 20:50:48 +0800</pubDate>
        
        <guid>https://luxcgo.github.io/posts/rust-intro/</guid>
        <description>Go猜想录 https://luxcgo.github.io/posts/rust-intro/ -- https://luxcgo.github.io/posts/rust-intro/ - 2020-2022 Go猜想录</description>
        </item>
    
    
    
        <item>
        <title>Go语言程序的一生</title>
        <link>https://luxcgo.github.io/posts/golang-program-lifecycle/</link>
        <pubDate>Mon, 24 Jan 2022 21:52:19 +0800</pubDate>
        
        <guid>https://luxcgo.github.io/posts/golang-program-lifecycle/</guid>
        <description>Go猜想录 https://luxcgo.github.io/posts/golang-program-lifecycle/ -&lt;h2 id=&#34;理解可执行文件&#34;&gt;理解可执行文件&lt;/h2&gt;
&lt;h3 id=&#34;编译过程&#34;&gt;编译过程&lt;/h3&gt;
&lt;p&gt;文本 -&amp;gt; 编译 -&amp;gt; 二进制可执行文件&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#228b22&#34;&gt;// 文本
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;package&lt;/span&gt; main

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;() {
	&lt;span style=&#34;color:#658b00&#34;&gt;println&lt;/span&gt;(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;hi&amp;#34;&lt;/span&gt;)
}

&lt;span style=&#34;color:#228b22&#34;&gt;// 编译
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;go&lt;/span&gt; build main.&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;go&lt;/span&gt;

&lt;span style=&#34;color:#228b22&#34;&gt;// 二进制可执行文件
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;main
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;编译过程详细版&#34;&gt;编译过程详细版&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;$ go build -x main.go
&lt;span style=&#34;color:#00688b&#34;&gt;WORK&lt;/span&gt;=/tmp/go-build3065476763
mkdir -p &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/
cat &amp;gt;&lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/_gomod_.go &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;lt;&amp;lt; &amp;#39;EOF&amp;#39; # internal
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;package main
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;import _ &amp;#34;unsafe&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;//go:linkname __debug_modinfo__ runtime.modinfo
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;var __debug_modinfo__ = &amp;#34;0w\xaf\f\x92t\b\x02A\xe1\xc1\a\xe6\xd6\x18\xe6path\tcommand-line-arguments\nmod\tcommand-line-arguments\t(devel)\t\n\xf92C1\x86\x18 r\x00\x82B\x10A\x16\xd8\xf2&amp;#34;
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;EOF&lt;/span&gt;
cat &amp;gt;&lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/importcfg &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;lt;&amp;lt; &amp;#39;EOF&amp;#39; # internal
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;# import config
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;packagefile runtime=/usr/lib/go-1.17/pkg/linux_amd64/runtime.a
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;EOF&lt;/span&gt;
&lt;span style=&#34;color:#658b00&#34;&gt;cd&lt;/span&gt; /home/lucas/github/go-higher/lifecycle
&lt;span style=&#34;color:#228b22&#34;&gt;# 编译: 文本代码 -&amp;gt; 目标文件(.o，.a)&lt;/span&gt;
/usr/lib/go-1.17/pkg/tool/linux_amd64/compile -o &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/_pkg_.a -trimpath &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;/b001=&amp;gt;&amp;#34;&lt;/span&gt; -p main -lang=go1.17 -complete -buildid lnP5TiJOsIUwPmLiIfPV/lnP5TiJOsIUwPmLiIfPV -goversion go1.17.5 -D _/home/lucas/github/go-higher/lifecycle -importcfg &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/importcfg -pack -c=&lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt; ./main.go &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/_gomod_.go
/usr/lib/go-1.17/pkg/tool/linux_amd64/buildid -w &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/_pkg_.a &lt;span style=&#34;color:#228b22&#34;&gt;# internal&lt;/span&gt;
cp &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/_pkg_.a /home/lucas/.cache/go-build/22/2265575b71ed2f5a520a0c207374b79d322454b578824e8c3c39f6bf10770432-d &lt;span style=&#34;color:#228b22&#34;&gt;# internal&lt;/span&gt;
cat &amp;gt;&lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/importcfg.link &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;lt;&amp;lt; &amp;#39;EOF&amp;#39; # internal
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;packagefile command-line-arguments=$WORK/b001/_pkg_.a
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;packagefile runtime=/usr/lib/go-1.17/pkg/linux_amd64/runtime.a
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;packagefile internal/abi=/usr/lib/go-1.17/pkg/linux_amd64/internal/abi.a
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;packagefile internal/bytealg=/usr/lib/go-1.17/pkg/linux_amd64/internal/bytealg.a
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;packagefile internal/cpu=/usr/lib/go-1.17/pkg/linux_amd64/internal/cpu.a
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;packagefile internal/goexperiment=/usr/lib/go-1.17/pkg/linux_amd64/internal/goexperiment.a
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;packagefile runtime/internal/atomic=/usr/lib/go-1.17/pkg/linux_amd64/runtime/internal/atomic.a
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;packagefile runtime/internal/math=/usr/lib/go-1.17/pkg/linux_amd64/runtime/internal/math.a
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;packagefile runtime/internal/sys=/usr/lib/go-1.17/pkg/linux_amd64/runtime/internal/sys.a
&lt;/span&gt;&lt;span style=&#34;color:#cd5555&#34;&gt;EOF&lt;/span&gt;
mkdir -p &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/exe/
&lt;span style=&#34;color:#658b00&#34;&gt;cd&lt;/span&gt; .
&lt;span style=&#34;color:#228b22&#34;&gt;# 链接: 将目标文件合并为可执行文件&lt;/span&gt;
/usr/lib/go-1.17/pkg/tool/linux_amd64/link -o &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/exe/a.out -importcfg &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/importcfg.link -buildmode=exe -buildid=G-g9D6X-2ZthM87RLc5o/lnP5TiJOsIUwPmLiIfPV/MZuyVms2pq5r1tYts6Az/G-g9D6X-2ZthM87RLc5o -extld=gcc &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/_pkg_.a
/usr/lib/go-1.17/pkg/tool/linux_amd64/buildid -w &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/exe/a.out &lt;span style=&#34;color:#228b22&#34;&gt;# internal&lt;/span&gt;
mv &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/exe/a.out main
rm -r &lt;span style=&#34;color:#00688b&#34;&gt;$WORK&lt;/span&gt;/b001/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;可执行文件&#34;&gt;可执行文件&lt;/h3&gt;
&lt;p&gt;linux中的可执行文件 ELF(Executable and Linkable Format) 由几部分构成：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELF header&lt;/li&gt;
&lt;li&gt;Section header&lt;/li&gt;
&lt;li&gt;Sections&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;操作系统执行可执行文件的步骤(以 linux 为例):&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;解析 ELF Header&lt;/li&gt;
&lt;li&gt;加载文件内容至内存&lt;/li&gt;
&lt;li&gt;从 entry point 开始执行代码&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;通过 entry point 找到 Go 进程的执行入口，使用 readelf&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;$ readelf -h ./main
ELF Header:
  Magic:   7f &lt;span style=&#34;color:#b452cd&#34;&gt;45&lt;/span&gt; 4c &lt;span style=&#34;color:#b452cd&#34;&gt;46&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;01&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;01&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color:#b452cd&#34;&gt;00&lt;/span&gt;
  Class:                             ELF64
  Data:                              2&lt;span style=&#34;color:#a61717;background-color:#e3d2d2&#34;&gt;&amp;#39;&lt;/span&gt;s complement, little endian
  Version:                           &lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt; (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;
  Type:                              EXEC (Executable file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  &lt;span style=&#34;color:#228b22&#34;&gt;# 执行入口&lt;/span&gt;
  Entry point address:               0x453b60
  Start of program headers:          &lt;span style=&#34;color:#b452cd&#34;&gt;64&lt;/span&gt; (bytes into file)
  Start of section headers:          &lt;span style=&#34;color:#b452cd&#34;&gt;456&lt;/span&gt; (bytes into file)
  Flags:                             0x0
  Size of this header:               &lt;span style=&#34;color:#b452cd&#34;&gt;64&lt;/span&gt; (bytes)
  Size of program headers:           &lt;span style=&#34;color:#b452cd&#34;&gt;56&lt;/span&gt; (bytes)
  Number of program headers:         &lt;span style=&#34;color:#b452cd&#34;&gt;7&lt;/span&gt;
  Size of section headers:           &lt;span style=&#34;color:#b452cd&#34;&gt;64&lt;/span&gt; (bytes)
  Number of section headers:         &lt;span style=&#34;color:#b452cd&#34;&gt;23&lt;/span&gt;
  Section header string table index: &lt;span style=&#34;color:#b452cd&#34;&gt;3&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;!-- raw HTML omitted --&gt;
- https://luxcgo.github.io/posts/golang-program-lifecycle/ - 2020-2022 Go猜想录</description>
        </item>
    
    
    
        <item>
        <title>Go语言Goroutine管理</title>
        <link>https://luxcgo.github.io/posts/go/golang-goroutine-manage/</link>
        <pubDate>Sun, 16 Jan 2022 14:31:07 +0800</pubDate>
        
        <guid>https://luxcgo.github.io/posts/go/golang-goroutine-manage/</guid>
        <description>Go猜想录 https://luxcgo.github.io/posts/go/golang-goroutine-manage/ -&lt;h2 id=&#34;goroutine&#34;&gt;Goroutine&lt;/h2&gt;
&lt;p&gt;操作系统会为该应用程序创建一个进程。作为一个应用程序，它像一个为所有资源而运行的容器。这些资源包括内存地址空间、文件句柄、设备和线程。&lt;/p&gt;
&lt;p&gt;线程是操作系统调度的一种执行路径，用于在处理器执行我们在函数中编写的代码。一个进程从一个线程开始，即主线程，当该线程终止时，进程终止。这是因为主线程是应用程序的原点。然后，主线程可以依次启动更多的线程，而这些线程可以启动更多的线程。&lt;/p&gt;
&lt;p&gt;无论线程属于哪个进程，操作系统都会安排线程在可用处理器上运行。每个操作系统都有自己的算法来做出这些决定。&lt;/p&gt;
&lt;p&gt;Go 语言层面支持的 go 关键字，可以快速的让一个函数创建为 goroutine，我们可以认为 main 函数就是作为 goroutine 执行的。操作系统调度线程在可用处理器上运行，Go运行时调度 goroutines 在绑定到单个操作系统线程的逻辑处理器中运行(P)。即使使用这个单一的逻辑处理器和操作系统线程，也可以调度数十万 goroutine 以惊人的效率和性能并发运行。&lt;/p&gt;
&lt;h2 id=&#34;如何清真的使用-goroutine&#34;&gt;如何清真的使用 goroutine&lt;/h2&gt;
&lt;h3 id=&#34;能不用就不用&#34;&gt;能不用就不用&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;package&lt;/span&gt; main

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;import&lt;/span&gt; (
	&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
	&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
)

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;() {
	http.&lt;span style=&#34;color:#008b45&#34;&gt;HandleFunc&lt;/span&gt;(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt;(w http.ResponseWriter, r *http.Request) {
		fmt.&lt;span style=&#34;color:#008b45&#34;&gt;Fprintln&lt;/span&gt;(w, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Hello, GopherCon SG&amp;#34;&lt;/span&gt;)
	})
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt;() {
		&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; err := http.&lt;span style=&#34;color:#008b45&#34;&gt;ListenAndServe&lt;/span&gt;(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;:8080&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;nil&lt;/span&gt;); err != &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
			log.&lt;span style=&#34;color:#008b45&#34;&gt;Fatal&lt;/span&gt;(err)
		}
	}()

	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;select&lt;/span&gt; {}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上面的程序可以看到，为了防止main.main退出，结尾使用了空的select语句阻塞住了主函数。某种意义上来说是一个好的做法因为没有使用for循环或其他浪费CPU的方式防止主进程退出。不过这仍然属于脱裤子放屁。因为在执行ListenAndServe函数的goroutine返回前什么都做不了，那就不如不开启一个goroutine去完成这个任务，直接在主线程里做。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果你的 goroutine 在从另一个 goroutine 获得结果之前无法取得进展，那么通常情况下，你自己去做这项工作比委托它( go func() )更简单。这通常消除了将结果从 goroutine 返回到其启动器所需的大量状态跟踪和 chan 操作。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;package&lt;/span&gt; main

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;import&lt;/span&gt; (
	&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
	&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
)

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;() {
	http.&lt;span style=&#34;color:#008b45&#34;&gt;HandleFunc&lt;/span&gt;(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt;(w http.ResponseWriter, r *http.Request) {
		fmt.&lt;span style=&#34;color:#008b45&#34;&gt;Fprintln&lt;/span&gt;(w, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Hello, GopherCon SG&amp;#34;&lt;/span&gt;)
	})
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; err := http.&lt;span style=&#34;color:#008b45&#34;&gt;ListenAndServe&lt;/span&gt;(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;:8080&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;nil&lt;/span&gt;); err != &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
		log.&lt;span style=&#34;color:#008b45&#34;&gt;Fatal&lt;/span&gt;(err)
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;调用者决定是否要并发&#34;&gt;调用者决定是否要并发&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#228b22&#34;&gt;// ListDirectory returns the contents of dir.
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;ListDirectory&lt;/span&gt;(dir &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;string&lt;/span&gt;) ([]&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;error&lt;/span&gt;)

&lt;span style=&#34;color:#228b22&#34;&gt;// ListDirectory returns a channel over which
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;// directory entries will be published. When the list
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;// of entries is exhausted, the channel will be closed.
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;ListDirectory&lt;/span&gt;(dir &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;string&lt;/span&gt;) &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;string&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;以上两个API设计的功能都是要读取所有的目录&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;将目录读取到一个 slice 中，然后返回整个切片，或者如果出现错误，则返回错误。这是同步调用的，ListDirectory 的调用方会阻塞，直到读取所有目录条目。根据目录的大小，这可能需要很长时间，并且可能会分配大量内存来构建目录条目名称的 slice。&lt;/li&gt;
&lt;li&gt;ListDirectory 返回一个 chan string，将通过该 chan 传递目录。当通道关闭时，这表示不再有目录。由于在 ListDirectory 返回后发生通道的填充，ListDirectory 可能内部启动 goroutine 来填充通道。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ListDirectory chan 版本还有两个问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过使用一个关闭的通道作为不再需要处理的项目的信号，ListDirectory 无法告诉调用者通过通道返回的项目集不完整，因为中途遇到了错误。调用方无法区分空目录与完全从目录读取的错误之间的区别。这两种方法都会导致从 ListDirectory 返回的通道会立即关闭。&lt;/li&gt;
&lt;li&gt;调用者必须继续从通道读取，直到它关闭，因为这是调用者知道开始填充通道的 goroutine 已经停止的唯一方法。这对 ListDirectory 的使用是一个严重的限制，调用者必须花时间从通道读取数据，即使它可能已经收到了它想要的答案。对于大中型目录，它可能在内存使用方面更为高效，但这种方法并不比原始的基于 slice 的方法快。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;解决之道是使用回调函数&lt;code&gt;func ListDirectory(dir string, fn func(string)) error&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;filepath.WalkDir 也是类似的模型，如果函数启动 goroutine，则必须向调用方提供显式停止该goroutine 的方法。通常，将异步执行函数的决定权交给该函数的调用方通常更容易。&lt;/p&gt;
&lt;h3 id=&#34;管理好整个生命周期&#34;&gt;管理好整个生命周期&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#228b22&#34;&gt;// leak is a buggy function. It launches a goroutine that
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;// blocks receiving from a channel. Nothing will ever be
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;// sent on that channel and the channel is never closed so
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;// that goroutine will be blocked forever.
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;leak&lt;/span&gt;() {
	ch := &lt;span style=&#34;color:#658b00&#34;&gt;make&lt;/span&gt;(&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt;)

	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt;() {
		val := &amp;lt;-ch
		fmt.&lt;span style=&#34;color:#008b45&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;We received a value:&amp;#34;&lt;/span&gt;, val)
	}()
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;开启一个goroutine时要知道它何时会结束&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;或者有什么手段可以让它结束&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这样就可以确保不会发生goroutine泄漏&lt;/p&gt;
&lt;h3 id=&#34;超时控制&#34;&gt;超时控制&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;package&lt;/span&gt; main

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;import&lt;/span&gt; (
	&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;context&amp;#34;&lt;/span&gt;
	&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
)

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;() {
	tr := &lt;span style=&#34;color:#008b45&#34;&gt;NewTracker&lt;/span&gt;()
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;go&lt;/span&gt; tr.&lt;span style=&#34;color:#008b45&#34;&gt;Run&lt;/span&gt;()
	_ = tr.&lt;span style=&#34;color:#008b45&#34;&gt;Event&lt;/span&gt;(context.&lt;span style=&#34;color:#008b45&#34;&gt;Background&lt;/span&gt;(), &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;t1&amp;#34;&lt;/span&gt;)
	_ = tr.&lt;span style=&#34;color:#008b45&#34;&gt;Event&lt;/span&gt;(context.&lt;span style=&#34;color:#008b45&#34;&gt;Background&lt;/span&gt;(), &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;t2&amp;#34;&lt;/span&gt;)
	_ = tr.&lt;span style=&#34;color:#008b45&#34;&gt;Event&lt;/span&gt;(context.&lt;span style=&#34;color:#008b45&#34;&gt;Background&lt;/span&gt;(), &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;t3&amp;#34;&lt;/span&gt;)
	time.&lt;span style=&#34;color:#008b45&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#b452cd&#34;&gt;3&lt;/span&gt; * time.Second)
	ctx, cancel := context.&lt;span style=&#34;color:#008b45&#34;&gt;WithDeadline&lt;/span&gt;(context.&lt;span style=&#34;color:#008b45&#34;&gt;Background&lt;/span&gt;(), time.&lt;span style=&#34;color:#008b45&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#008b45&#34;&gt;Add&lt;/span&gt;(&lt;span style=&#34;color:#b452cd&#34;&gt;5&lt;/span&gt;*time.Second))
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;cancel&lt;/span&gt;()
    &lt;span style=&#34;color:#228b22&#34;&gt;// 由写的人去关闭channel
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;	tr.&lt;span style=&#34;color:#008b45&#34;&gt;Shutdown&lt;/span&gt;(ctx)
}

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;NewTracker&lt;/span&gt;() *Tracker {
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &amp;amp;Tracker{
		ch: &lt;span style=&#34;color:#658b00&#34;&gt;make&lt;/span&gt;(&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#b452cd&#34;&gt;10&lt;/span&gt;),
	}
}

&lt;span style=&#34;color:#228b22&#34;&gt;// Tracker knows how to track events for the application.
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;type&lt;/span&gt; Tracker &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; {
	ch   &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;string&lt;/span&gt;
	stop &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt;{}
}

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; (t *Tracker) &lt;span style=&#34;color:#008b45&#34;&gt;Event&lt;/span&gt;(ctx context.Context, data &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;string&lt;/span&gt;) &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;error&lt;/span&gt; {
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;select&lt;/span&gt; {
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;case&lt;/span&gt; t.ch &amp;lt;- data:
		&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;nil&lt;/span&gt;
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;case&lt;/span&gt; &amp;lt;-ctx.&lt;span style=&#34;color:#008b45&#34;&gt;Done&lt;/span&gt;():
		&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; ctx.&lt;span style=&#34;color:#008b45&#34;&gt;Err&lt;/span&gt;()

	}
}

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; (t *Tracker) &lt;span style=&#34;color:#008b45&#34;&gt;Run&lt;/span&gt;() {
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; data := &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;range&lt;/span&gt; t.ch {
		time.&lt;span style=&#34;color:#008b45&#34;&gt;Sleep&lt;/span&gt;(time.Second)
		&lt;span style=&#34;color:#658b00&#34;&gt;println&lt;/span&gt;(data)
	}
	t.stop &amp;lt;- &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt;{}{}
}

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; (t *Tracker) &lt;span style=&#34;color:#008b45&#34;&gt;Shutdown&lt;/span&gt;(ctx context.Context) {
	&lt;span style=&#34;color:#658b00&#34;&gt;close&lt;/span&gt;(t.ch)
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;select&lt;/span&gt; {
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;case&lt;/span&gt; &amp;lt;-t.stop:
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;case&lt;/span&gt; &amp;lt;-ctx.&lt;span style=&#34;color:#008b45&#34;&gt;Done&lt;/span&gt;():
	}
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;一个好点的使用案例&#34;&gt;一个好点的使用案例&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;package&lt;/span&gt; main

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;import&lt;/span&gt; (
	&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;context&amp;#34;&lt;/span&gt;
	&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
)

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;serve&lt;/span&gt;(addr &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;string&lt;/span&gt;, handler http.Handler, stop &amp;lt;-&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt;{}) &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;error&lt;/span&gt; {
	s := http.Server{
		Addr:    addr,
		Handler: handler,
	}

	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt;() {
		&amp;lt;-stop &lt;span style=&#34;color:#228b22&#34;&gt;// wait for stop signal
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;		s.&lt;span style=&#34;color:#008b45&#34;&gt;Shutdown&lt;/span&gt;(context.&lt;span style=&#34;color:#008b45&#34;&gt;Background&lt;/span&gt;())
	}()

	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; s.&lt;span style=&#34;color:#008b45&#34;&gt;ListenAndServe&lt;/span&gt;()
}

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;serveApp&lt;/span&gt;(stop &amp;lt;-&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt;{}) &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;error&lt;/span&gt; {
	mux := http.&lt;span style=&#34;color:#008b45&#34;&gt;NewServeMux&lt;/span&gt;()
	mux.&lt;span style=&#34;color:#008b45&#34;&gt;HandleFunc&lt;/span&gt;(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt;(resp http.ResponseWriter, req *http.Request) {
		fmt.&lt;span style=&#34;color:#008b45&#34;&gt;Fprintln&lt;/span&gt;(resp, &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;Hello, QCon!&amp;#34;&lt;/span&gt;)
	})
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;serve&lt;/span&gt;(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;0.0.0.0:8080&amp;#34;&lt;/span&gt;, mux, stop)
}

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;serveDebug&lt;/span&gt;(stop &amp;lt;-&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt;{}) &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;error&lt;/span&gt; {
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;serve&lt;/span&gt;(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;127.0.0.1:8001&amp;#34;&lt;/span&gt;, http.DefaultServeMux, stop)
}

&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;main&lt;/span&gt;() {
	done := &lt;span style=&#34;color:#658b00&#34;&gt;make&lt;/span&gt;(&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;error&lt;/span&gt;, &lt;span style=&#34;color:#b452cd&#34;&gt;2&lt;/span&gt;)
	stop := &lt;span style=&#34;color:#658b00&#34;&gt;make&lt;/span&gt;(&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt;{})
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt;() {
		done &amp;lt;- &lt;span style=&#34;color:#008b45&#34;&gt;serveDebug&lt;/span&gt;(stop)
	}()
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt;() {
		done &amp;lt;- &lt;span style=&#34;color:#008b45&#34;&gt;serveApp&lt;/span&gt;(stop)
	}()

	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;var&lt;/span&gt; stopped &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;bool&lt;/span&gt;
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;for&lt;/span&gt; i := &lt;span style=&#34;color:#b452cd&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#658b00&#34;&gt;cap&lt;/span&gt;(done); i++ {
		&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; err := &amp;lt;-done; err != &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;nil&lt;/span&gt; {
			fmt.&lt;span style=&#34;color:#008b45&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;error: %v\n&amp;#34;&lt;/span&gt;, err)
		}
		&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;if&lt;/span&gt; !stopped {
			stopped = &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;true&lt;/span&gt;
			&lt;span style=&#34;color:#658b00&#34;&gt;close&lt;/span&gt;(stop)
		}
	}
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;优点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;管理好了所有goroutine的生命周期，不会有泄露&lt;/li&gt;
&lt;li&gt;任何一个goroutine出现问题，都会让所有其他的goroutine优雅退出，不会造成任何数据的丢失&lt;/li&gt;
&lt;li&gt;所有需要后台执行的任务都是由调用者来决定&lt;/li&gt;
&lt;li&gt;调用者开启goroutine时有结束它的手段&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;reference&#34;&gt;Reference&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://go.dev/doc/faq#goroutines&#34;&gt;Why goroutines instead of threads?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://dave.cheney.net/practical-go/presentations/qcon-china.html&#34;&gt;Practical Go: Real world advice for writing maintainable Go programs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.ardanlabs.com/blog/2018/11/goroutine-leaks-the-forgotten-sender.html&#34;&gt;Goroutine Leaks - The Forgotten Sender&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.ardanlabs.com/blog/2019/04/concurrency-trap-2-incomplete-work.html&#34;&gt;Concurrency Trap #2: Incomplete Work&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/da440dil&#34;&gt;da440dil&lt;/a&gt;/&lt;a href=&#34;https://github.com/da440dil/go-workgroup&#34;&gt;go-workgroup&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
- https://luxcgo.github.io/posts/go/golang-goroutine-manage/ - 2020-2022 Go猜想录</description>
        </item>
    
    
    
        <item>
        <title>博客诞生记</title>
        <link>https://luxcgo.github.io/posts/%E5%B7%A5%E7%A8%8B/%E5%8D%9A%E5%AE%A2%E8%AF%9E%E7%94%9F%E8%AE%B0/</link>
        <pubDate>Sun, 09 Jan 2022 22:16:50 +0800</pubDate>
        
        <guid>https://luxcgo.github.io/posts/%E5%B7%A5%E7%A8%8B/%E5%8D%9A%E5%AE%A2%E8%AF%9E%E7%94%9F%E8%AE%B0/</guid>
        <description>Go猜想录 https://luxcgo.github.io/posts/%E5%B7%A5%E7%A8%8B/%E5%8D%9A%E5%AE%A2%E8%AF%9E%E7%94%9F%E8%AE%B0/ -&lt;h2 id=&#34;tldr&#34;&gt;TL;DR&lt;/h2&gt;
&lt;p&gt;使用自定义指令hn，含义是hugo deploy。自动构建两个网站luxcgo.github.io和luxcgo.com的静态文件，分别是用于国外和国内访问，然后推送到我的私有仓库中，通过submodule功能同步到公有仓库。随即触发github action构建网站镜像推送到私有镜像仓库中，我的云服务器检测到镜像更新自动拉取完成网站更新。&lt;/p&gt;
&lt;h2 id=&#34;技术选型&#34;&gt;技术选型&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;前端：静态博客&lt;a href=&#34;https://gohugo.io/&#34;&gt;hugo&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;主题：参数尽量两种主题都可以使用&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;  ---
  title: &lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
  date: 2021-11-15T01:39:12+08:00
  draft: &lt;span style=&#34;color:#658b00&#34;&gt;true&lt;/span&gt;

  title: Git
  weight: &lt;span style=&#34;color:#b452cd&#34;&gt;1&lt;/span&gt;
  bookToc: &lt;span style=&#34;color:#658b00&#34;&gt;false&lt;/span&gt;
  bookHidden: &lt;span style=&#34;color:#658b00&#34;&gt;true&lt;/span&gt;
  bookCollapseSection: &lt;span style=&#34;color:#658b00&#34;&gt;true&lt;/span&gt;
  ---
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://themes.gohugo.io/hugo-theme-diary/&#34;&gt;diary&lt;/a&gt;作为日常发布&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://themes.gohugo.io/themes/hugo-book/&#34;&gt;book&lt;/a&gt;作为整合发布&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;后端：服务器选择&lt;a href=&#34;https://hub.docker.com/_/caddy&#34;&gt;caddy 2&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;运维：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用&lt;a href=&#34;https://traefik.io/&#34;&gt;traefik&lt;/a&gt;签发证书和反向代理&lt;/li&gt;
&lt;li&gt;使用deploy脚本自动构建静态文件和推送&lt;/li&gt;
&lt;li&gt;使用github action在推送时自动构建镜像并分别推送
&lt;ul&gt;
&lt;li&gt;使用git submodule&lt;/li&gt;
&lt;li&gt;luxcgo.github.io&lt;/li&gt;
&lt;li&gt;luxcgo.com&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;使用watchtower自动更新网站&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;定制化&#34;&gt;定制化&lt;/h2&gt;
&lt;h3 id=&#34;评论系统&#34;&gt;评论系统&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://utteranc.es/&#34;&gt;utteranc&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;issue以filepath作为唯一索引&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://segmentfault.com/a/1190000018072952&#34;&gt;gitalk&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;自动化&#34;&gt;自动化&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;vim ~/.zshrc
&lt;span style=&#34;color:#228b22&#34;&gt;# 自动化创建并打开文件&lt;/span&gt;
&lt;span style=&#34;color:#228b22&#34;&gt;# hn 文件名 (代表 hugo new posts/文件名.md)&lt;/span&gt;
&lt;span style=&#34;color:#658b00&#34;&gt;alias&lt;/span&gt; &lt;span style=&#34;color:#00688b&#34;&gt;hn&lt;/span&gt;=&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#39;_hn(){ cd /Users/lucas/Documents/blog &amp;amp;&amp;amp; hugo new posts/$1.md &amp;amp;&amp;amp; open -a typora /Users/lucas/Documents/blog/content/posts/$1.md; }; _hn&amp;#39;&lt;/span&gt;

&lt;span style=&#34;color:#228b22&#34;&gt;# 自动化部署&lt;/span&gt;
&lt;span style=&#34;color:#228b22&#34;&gt;# hd (代表 ./deploy)&lt;/span&gt;
&lt;span style=&#34;color:#658b00&#34;&gt;alias&lt;/span&gt; &lt;span style=&#34;color:#00688b&#34;&gt;hd&lt;/span&gt;=&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#39;_hd(){ cd /Users/lucas/Documents/blog &amp;amp;&amp;amp; ./deploy; }; _hd&amp;#39;&lt;/span&gt;

&lt;span style=&#34;color:#658b00&#34;&gt;source&lt;/span&gt; ~/.zshrc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;图片存储&#34;&gt;图片存储&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.tencent.com/developer/article/1722255&#34;&gt;本地储存&lt;/a&gt; + &lt;a href=&#34;https://github.com/dabutvin/Imgbot&#34;&gt;图片压缩&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;PicGo自动上传 + &lt;a href=&#34;https://github.com/fhyoga/picgo-plugin-watermark&#34;&gt;水印插件&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://fonts.google.com/specimen/Nanum+Pen+Script?preview.text=@luxcgo&amp;amp;preview.text_type=custom#standard-styles&#34;&gt;字体&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;字号：28px&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;其他&#34;&gt;其他&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://redketchup.io/favicon-generator&#34;&gt;favicon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://analytics.google.com/analytics&#34;&gt;Google Analytics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://search.google.com/search-console&#34;&gt;谷歌收录&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://busuanzi.ibruce.info/&#34;&gt;不蒜子&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;搜索功能&lt;/li&gt;
&lt;li&gt;utterances增加定制化label&lt;/li&gt;
&lt;li&gt;新建comment repo&lt;/li&gt;
&lt;li&gt;文章权重&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;参考资料&#34;&gt;参考资料&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://unknwon.cn/2020/200419-mew-home-unknwon-cn/&#34;&gt;Unknwon.中文博客搬新家&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://byvoid.com/zhs/&#34;&gt;Beyond the Void&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/BYVoid/hugo-theme-diary&#34;&gt;Diary theme customized&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://orianna-zzo.github.io/series/blog%E5%85%BB%E6%88%90%E8%AE%B0/&#34;&gt;ZHENG Zi&amp;rsquo;ou.Blog养成记&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://youngkin.github.io/post/createafreeblogsite/&#34;&gt;Deploy script&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://support.typora.io/Use-Typora-From-Shell-or-cmd/&#34;&gt;Use Typora from Shell or Cmd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.zhihu.com/question/23137414&#34;&gt;bash alias怎么解析传入的参数的？&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
- https://luxcgo.github.io/posts/%E5%B7%A5%E7%A8%8B/%E5%8D%9A%E5%AE%A2%E8%AF%9E%E7%94%9F%E8%AE%B0/ - 2020-2022 Go猜想录</description>
        </item>
    
    
    
        <item>
        <title>Tinykv第三方指导书</title>
        <link>https://luxcgo.github.io/posts/tinykv%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8C%87%E5%AF%BC%E4%B9%A6/</link>
        <pubDate>Sun, 12 Dec 2021 17:41:03 +0800</pubDate>
        
        <guid>https://luxcgo.github.io/posts/tinykv%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8C%87%E5%AF%BC%E4%B9%A6/</guid>
        <description>Go猜想录 https://luxcgo.github.io/posts/tinykv%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8C%87%E5%AF%BC%E4%B9%A6/ -&lt;h1 id=&#34;project2a-实现raft算法&#34;&gt;Project2A 实现Raft算法&lt;/h1&gt;
&lt;h2 id=&#34;数据结构&#34;&gt;数据结构&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#228b22&#34;&gt;// Prs map[uint64]*Progress
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;// leader用来维护所有follower的日志进度信息
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;type&lt;/span&gt; Progress &lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;struct&lt;/span&gt; {
    &lt;span style=&#34;color:#228b22&#34;&gt;// 当前follower和leader最后一个一致的日志的index
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;	Match &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;uint64&lt;/span&gt;
    &lt;span style=&#34;color:#228b22&#34;&gt;// 当前follower希望leader下一次同步日志时，第一条日志的index
&lt;/span&gt;&lt;span style=&#34;color:#228b22&#34;&gt;&lt;/span&gt;    Next &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;uint64&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;消息处理&#34;&gt;消息处理&lt;/h2&gt;
&lt;h3 id=&#34;msgpropose&#34;&gt;MsgPropose&lt;/h3&gt;
&lt;p&gt;作用：提议在领导者节点添加新的日志&lt;/p&gt;
&lt;p&gt;类型：本地消息&lt;/p&gt;
&lt;p&gt;处理者：领导人&lt;/p&gt;
&lt;h1 id=&#34;test&#34;&gt;Test&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;newTestRaft&lt;/span&gt;(id &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;uint64&lt;/span&gt;, peers []&lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;uint64&lt;/span&gt;, election, heartbeat &lt;span style=&#34;color:#00688b;font-weight:bold&#34;&gt;int&lt;/span&gt;, storage Storage) *Raft {
	&lt;span style=&#34;color:#8b008b;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#008b45&#34;&gt;newRaft&lt;/span&gt;(&lt;span style=&#34;color:#008b45&#34;&gt;newTestConfig&lt;/span&gt;(id, peers, election, heartbeat, storage))
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;- https://luxcgo.github.io/posts/tinykv%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8C%87%E5%AF%BC%E4%B9%A6/ - 2020-2022 Go猜想录</description>
        </item>
    
    
    
        <item>
        <title>寻找一种易于理解的raft算法的解读</title>
        <link>https://luxcgo.github.io/posts/%E5%AF%BB%E6%89%BE%E4%B8%80%E7%A7%8D%E6%98%93%E4%BA%8E%E7%90%86%E8%A7%A3%E7%9A%84raft%E7%AE%97%E6%B3%95%E7%9A%84%E8%A7%A3%E8%AF%BB/</link>
        <pubDate>Thu, 02 Dec 2021 01:49:21 +0800</pubDate>
        
        <guid>https://luxcgo.github.io/posts/%E5%AF%BB%E6%89%BE%E4%B8%80%E7%A7%8D%E6%98%93%E4%BA%8E%E7%90%86%E8%A7%A3%E7%9A%84raft%E7%AE%97%E6%B3%95%E7%9A%84%E8%A7%A3%E8%AF%BB/</guid>
        <description>Go猜想录 https://luxcgo.github.io/posts/%E5%AF%BB%E6%89%BE%E4%B8%80%E7%A7%8D%E6%98%93%E4%BA%8E%E7%90%86%E8%A7%A3%E7%9A%84raft%E7%AE%97%E6%B3%95%E7%9A%84%E8%A7%A3%E8%AF%BB/ -&lt;p&gt;尽管脱胎于paxos的raft算法的主要目的是容易开发者理解和实现，我作为一个分布式小白初读raft论文后还是一头雾水。主要原因我认为一是前置知识欠缺，二是论文中的一些结论的应用场景和由来没有指明，三是论文组织层层交错有一定难度。所以在我还没有被这部分知识诅咒之前，尝试把自己的理解表达出来，希望可以减少消磨一些同学们的意志力帮助理解。如有错误,还请大佬们不吝指正。&lt;/p&gt;
&lt;p&gt;拆解拆解&lt;/p&gt;
- https://luxcgo.github.io/posts/%E5%AF%BB%E6%89%BE%E4%B8%80%E7%A7%8D%E6%98%93%E4%BA%8E%E7%90%86%E8%A7%A3%E7%9A%84raft%E7%AE%97%E6%B3%95%E7%9A%84%E8%A7%A3%E8%AF%BB/ - 2020-2022 Go猜想录</description>
        </item>
    
    
    
        <item>
        <title>Raft算法解读与实现</title>
        <link>https://luxcgo.github.io/posts/raft%E7%AE%97%E6%B3%95%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%AE%9E%E7%8E%B0/</link>
        <pubDate>Tue, 23 Nov 2021 23:44:34 +0800</pubDate>
        
        <guid>https://luxcgo.github.io/posts/raft%E7%AE%97%E6%B3%95%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%AE%9E%E7%8E%B0/</guid>
        <description>Go猜想录 https://luxcgo.github.io/posts/raft%E7%AE%97%E6%B3%95%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%AE%9E%E7%8E%B0/ -&lt;p&gt;脑裂&lt;/p&gt;
&lt;p&gt;随机超时时间&lt;/p&gt;
&lt;p&gt;最高端的系统设计往往只拥有最朴素的实现目标&lt;/p&gt;
- https://luxcgo.github.io/posts/raft%E7%AE%97%E6%B3%95%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%AE%9E%E7%8E%B0/ - 2020-2022 Go猜想录</description>
        </item>
    
    
    
        <item>
        <title>如何从豆瓣FM转移到网易云音乐？</title>
        <link>https://luxcgo.github.io/posts/%E9%97%B2%E8%B0%88/%E5%A6%82%E4%BD%95%E4%BB%8E%E8%B1%86%E7%93%A3fm%E8%BD%AC%E7%A7%BB%E5%88%B0%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90/</link>
        <pubDate>Mon, 15 Nov 2021 01:39:12 +0800</pubDate>
        
        <guid>https://luxcgo.github.io/posts/%E9%97%B2%E8%B0%88/%E5%A6%82%E4%BD%95%E4%BB%8E%E8%B1%86%E7%93%A3fm%E8%BD%AC%E7%A7%BB%E5%88%B0%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90/</guid>
        <description>Go猜想录 https://luxcgo.github.io/posts/%E9%97%B2%E8%B0%88/%E5%A6%82%E4%BD%95%E4%BB%8E%E8%B1%86%E7%93%A3fm%E8%BD%AC%E7%A7%BB%E5%88%B0%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90/ -&lt;p&gt;曾几何时，我是爱着豆瓣fm的，我在上面听了将近两万首歌，红心了近两千首歌曲。但最近她的推荐算法没那么好用的，过去的红心歌曲因为版权能听的也只有寥寥一百余首了。是时候逃离了。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;下载红心歌曲链接，这是一个维护了十年的&lt;a href=&#34;https://github.com/loveunk/douban-favorite-music-parser&#34;&gt;豆瓣电台加心歌曲爬虫&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;下载红心歌曲，迅雷即可&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;上传到网易云音乐云盘&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;网易云对Mac未开放接口，M1 Mac还不支持X86架构的安卓模拟器，只能用开源API了&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Binaryify/NeteaseCloudMusicApi&#34;&gt;网易云音乐 Node.js API service&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;安装好后依赖后，可以直接运行他准备好的code批量上传，他有可能会上传失败，所以多跑几次就好了。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;// /github/NeteaseCloudMusicApi/module_example/multi_song_upload.js
node multi_song_upload.js --phone_number=&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;xx&amp;#34;&lt;/span&gt; --password=&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#34;xx&amp;#34;&lt;/span&gt; --dir=&lt;span style=&#34;color:#cd5555&#34;&gt;&amp;#39;/Users/xx/Music&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;voila&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
- https://luxcgo.github.io/posts/%E9%97%B2%E8%B0%88/%E5%A6%82%E4%BD%95%E4%BB%8E%E8%B1%86%E7%93%A3fm%E8%BD%AC%E7%A7%BB%E5%88%B0%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90/ - 2020-2022 Go猜想录</description>
        </item>
    
    
  </channel>
</rss> 